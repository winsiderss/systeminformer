# System Informer 기술스택

## 문서 정보
- **프로젝트명**: System Informer
- **문서 버전**: 1.0
- **작성일**: 2026-01-25

---

## 1. 기술스택 개요

```
┌─────────────────────────────────────────────────────────────────────┐
│                     System Informer 기술스택                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      프로그래밍 언어                          │   │
│  │     C (95%)  │  C++ (4%)  │  PowerShell (1%)                │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                       Windows API                            │   │
│  │  Win32 API │ Native NT API │ WDM │ ETW │ WMI │ COM/DirectX  │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                       빌드 시스템                             │   │
│  │    Visual Studio 2022  │  MSBuild  │  CMake  │  WDK         │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      써드파티 라이브러리                       │   │
│  │  JSON-C │ PCRE │ Zydis │ MaxMindDB │ MinIZ │ Detours       │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 2. 프로그래밍 언어

### 2.1 C 언어 (주요 언어)

**버전**: C11 / C17 (최신 표준)
**컴파일러**: MSVC (Microsoft Visual C++)

#### 사용 이유

1. **저수준 시스템 접근**: Windows 커널 및 Native API와 직접 상호작용
2. **성능 최적화**: 메모리 및 CPU 효율적 사용
3. **드라이버 개발**: WDM 드라이버는 C로 작성
4. **호환성**: Windows API와 자연스러운 통합

#### 코드 통계

| 구분 | 파일 수 | 코드 라인 |
|------|---------|-----------|
| 애플리케이션 (SystemInformer) | 89개 | ~400,000 |
| 라이브러리 (phlib) | 75개 | ~300,000 |
| 드라이버 (KSystemInformer) | 42개 | ~150,000 |
| 플러그인 | 189개 | ~90,000 |
| **총계** | 504개 | ~940,000 |

#### 코딩 컨벤션

```c
// 함수 명명 규칙 (헝가리안 표기법 변형)
NTSTATUS PhOpenProcess(
    _Out_ PHANDLE ProcessHandle,    // 출력 파라미터
    _In_ ACCESS_MASK DesiredAccess, // 입력 파라미터
    _In_ HANDLE ProcessId           // 입력 파라미터
    );

// SAL 주석 사용
_Success_(return != NULL)
_Must_inspect_result_
PPH_STRING PhCreateString(
    _In_ PWSTR Buffer
    );

// 참조 카운팅 패턴
PhReferenceObject(Object);
PhDereferenceObject(Object);
```

### 2.2 C++ 언어 (보조 언어)

**버전**: C++17 / C++20
**사용 영역**: GUI 컴포넌트, COM 인터페이스

#### 사용 파일

| 파일 | 위치 | 용도 |
|------|------|------|
| notiftoast.cpp | SystemInformer/ | Windows Toast 알림 |
| guisuplistview.cpp | phlib/ | ListView 확장 |
| devicetree.cpp | plugins/HardwareDevices/ | 디바이스 트리 |

### 2.3 PowerShell (스크립트)

**용도**: 빌드 자동화, 코드 생성

#### 주요 스크립트

```
build/
├── build_zwntapi.ps1      # Native API 헤더 생성
├── build_init.ps1         # 빌드 초기화
└── build_release.ps1      # 릴리스 빌드
```

---

## 3. Windows API 스택

### 3.1 Win32 API

**설명**: 표준 Windows 애플리케이션 개발 API

#### 사용 영역

| 카테고리 | API 함수 | 용도 |
|----------|----------|------|
| 윈도우 관리 | CreateWindowEx, SetWindowPos | GUI 생성/관리 |
| 컨트롤 | ListView, TreeView, ComboBox | UI 컨트롤 |
| 대화상자 | DialogBoxParam, MessageBox | 대화상자 |
| 메뉴 | CreateMenu, AppendMenu | 메뉴 관리 |
| GDI | GetDC, BitBlt, CreateFont | 그래픽 렌더링 |
| 파일 | CreateFile, ReadFile | 파일 I/O |
| 프로세스 | CreateProcess, OpenProcess | 프로세스 관리 |
| 스레드 | CreateThread, WaitForSingleObject | 스레드 관리 |
| 레지스트리 | RegOpenKeyEx, RegQueryValueEx | 레지스트리 접근 |
| 서비스 | OpenSCManager, StartService | 서비스 관리 |

### 3.2 Native NT API (NTAPI)

**설명**: Windows 커널과 직접 통신하는 비공개 API
**헤더 위치**: `phnt/` 디렉토리

#### 핵심 함수

```c
// 프로세스 관련
NTSTATUS NtQuerySystemInformation(
    SYSTEM_INFORMATION_CLASS SystemInformationClass,
    PVOID SystemInformation,
    ULONG SystemInformationLength,
    PULONG ReturnLength
);

NTSTATUS NtQueryInformationProcess(
    HANDLE ProcessHandle,
    PROCESSINFOCLASS ProcessInformationClass,
    PVOID ProcessInformation,
    ULONG ProcessInformationLength,
    PULONG ReturnLength
);

// 메모리 관련
NTSTATUS NtReadVirtualMemory(
    HANDLE ProcessHandle,
    PVOID BaseAddress,
    PVOID Buffer,
    SIZE_T BufferSize,
    PSIZE_T NumberOfBytesRead
);

NTSTATUS NtWriteVirtualMemory(
    HANDLE ProcessHandle,
    PVOID BaseAddress,
    PVOID Buffer,
    SIZE_T BufferSize,
    PSIZE_T NumberOfBytesWritten
);

// 핸들 관련
NTSTATUS NtQueryObject(
    HANDLE Handle,
    OBJECT_INFORMATION_CLASS ObjectInformationClass,
    PVOID ObjectInformation,
    ULONG ObjectInformationLength,
    PULONG ReturnLength
);
```

#### phnt 헤더 구조

```
phnt/
├── ntbcd.h          # 부팅 구성 데이터
├── ntd3dkmt.h       # Direct3D 커널 모드
├── ntdbg.h          # 디버깅
├── ntexapi.h        # 확장 API
├── ntgdi.h          # GDI
├── ntheap.h         # 힙 관리
├── ntioapi.h        # I/O 관리
├── ntkeapi.h        # 커널 확장
├── ntldr.h          # 로더
├── ntlpcapi.h       # LPC (로컬 프로시저 호출)
├── ntmisc.h         # 기타
├── ntmmapi.h        # 메모리 관리
├── ntnls.h          # NLS (국가 언어 지원)
├── ntobapi.h        # 객체 관리
├── ntpebteb.h       # PEB/TEB 구조체
├── ntpfapi.h        # 페이지 파일
├── ntpnpapi.h       # 플러그 앤 플레이
├── ntpoapi.h        # 전원 관리
├── ntpsapi.h        # 프로세스/스레드
├── ntregapi.h       # 레지스트리
├── ntrtl.h          # 런타임 라이브러리
├── ntsam.h          # SAM (보안 계정 관리)
├── ntseapi.h        # 보안
├── ntsmss.h         # 세션 관리
├── nttmapi.h        # 트랜잭션 관리
├── nttp.h           # 스레드 풀
├── ntwmi.h          # WMI
├── ntwow64.h        # WOW64
├── ntxcapi.h        # 예외 처리
├── ntzwapi.h        # Zw 시스템 콜
├── phnt.h           # 메인 헤더
├── phnt_ntdef.h     # 기본 정의
└── phnt_windows.h   # Windows 호환 정의
```

### 3.3 WDM (Windows Driver Model)

**설명**: 커널 모드 드라이버 개발 프레임워크
**사용 위치**: `KSystemInformer/`

#### 드라이버 구조

```c
// 드라이버 진입점
NTSTATUS DriverEntry(
    _In_ PDRIVER_OBJECT DriverObject,
    _In_ PUNICODE_STRING RegistryPath
)
{
    // 드라이버 초기화
    DriverObject->MajorFunction[IRP_MJ_CREATE] = KphDispatchCreate;
    DriverObject->MajorFunction[IRP_MJ_CLOSE] = KphDispatchClose;
    DriverObject->MajorFunction[IRP_MJ_DEVICE_CONTROL] = KphDispatchDeviceControl;
    DriverObject->DriverUnload = KphDriverUnload;

    return STATUS_SUCCESS;
}
```

#### 사용 커널 API

| API | 용도 |
|-----|------|
| PsSetCreateProcessNotifyRoutine | 프로세스 생성/종료 알림 |
| PsSetCreateThreadNotifyRoutine | 스레드 생성/종료 알림 |
| PsSetLoadImageNotifyRoutine | 이미지 로드 알림 |
| CmRegisterCallback | 레지스트리 콜백 |
| ObRegisterCallbacks | 객체 콜백 |
| FltRegisterFilter | 미니필터 드라이버 |
| ZwQuerySystemInformation | 시스템 정보 쿼리 |
| ZwOpenProcess | 프로세스 열기 |
| ZwQueryInformationProcess | 프로세스 정보 쿼리 |

### 3.4 ETW (Event Tracing for Windows)

**설명**: 고성능 이벤트 추적 시스템
**사용 위치**: `plugins/ExtendedTools/`

#### 추적 대상

| 이벤트 타입 | 설명 |
|-------------|------|
| 디스크 I/O | 읽기/쓰기 작업 추적 |
| 네트워크 I/O | 송수신 추적 |
| 파일 시스템 | 파일 작업 추적 |
| 프로세스 | 프로세스 이벤트 |
| 스레드 | 스레드 이벤트 |
| 이미지 로드 | DLL/EXE 로드 |

#### ETW 사용 코드 패턴

```c
// ETW 세션 시작
StartTrace(&SessionHandle, SessionName, &TraceProperties);

// 공급자 활성화
EnableTraceEx2(
    SessionHandle,
    &ProviderGuid,
    EVENT_CONTROL_CODE_ENABLE_PROVIDER,
    TRACE_LEVEL_INFORMATION,
    0, 0, 0, NULL
);

// 이벤트 처리
ProcessTrace(&SessionHandle, 1, NULL, NULL);
```

### 3.5 WMI (Windows Management Instrumentation)

**설명**: 시스템 관리 인터페이스
**사용 위치**: `SystemInformer/prpgwmi.c`

#### 쿼리 대상

```
Win32_Process         프로세스 정보
Win32_Service         서비스 정보
Win32_ComputerSystem  컴퓨터 시스템
Win32_OperatingSystem OS 정보
Win32_PhysicalMemory  물리 메모리
Win32_Processor       프로세서 정보
```

### 3.6 COM/DirectX

**설명**: GPU 정보 및 그래픽 관련 API
**사용 위치**: `plugins/ExtendedTools/`, `plugins/HardwareDevices/`

#### 사용 API

| API | 용도 |
|-----|------|
| D3DKMTQueryStatistics | GPU 통계 쿼리 |
| D3DKMTOpenAdapterFromLuid | 어댑터 열기 |
| IDXGIFactory | DXGI 팩토리 |
| IDXGIAdapter | 어댑터 정보 |

---

## 4. 빌드 시스템

### 4.1 Visual Studio

**버전**: Visual Studio 2022 (v17.x)
**필수 구성 요소**:

```
워크로드:
├── C++를 사용한 데스크톱 개발
├── Windows 10/11 SDK
└── C++ ATL for v143 build tools

개별 구성 요소:
├── MSVC v143 - VS 2022 C++ x64/x86 build tools
├── MSVC v143 - VS 2022 C++ ARM64 build tools
├── Windows 10 SDK (10.0.22621.0)
├── C++ ATL for latest v143 build tools
└── C++ MFC for latest v143 build tools
```

### 4.2 MSBuild

**설명**: Microsoft 빌드 엔진
**프로젝트 파일**: `.vcxproj`

#### 솔루션 구조

```
SystemInformer.sln
├── SystemInformer.vcxproj     # 메인 애플리케이션
├── phlib.vcxproj              # 핵심 라이브러리
├── peview.vcxproj             # PE 뷰어
└── kphlib.vcxproj             # KPH 라이브러리

KSystemInformer.sln
├── KSystemInformer.vcxproj    # 커널 드라이버
└── ksidll.vcxproj             # 드라이버 DLL

Plugins.sln
├── DotNetTools.vcxproj
├── ExtendedTools.vcxproj
├── HardwareDevices.vcxproj
├── NetworkTools.vcxproj
├── ExtendedServices.vcxproj
├── ExtendedNotifications.vcxproj
├── ToolStatus.vcxproj
├── OnlineChecks.vcxproj
├── Updater.vcxproj
├── UserNotes.vcxproj
└── WindowExplorer.vcxproj
```

### 4.3 CMake

**버전**: 3.30.0 이상
**설정 파일**: `CMakeLists.txt`

#### CMake 옵션

```cmake
# 빌드 옵션
option(SI_WITH_CORE "Build core components" ON)
option(SI_WITH_PLUGINS "Build plugins" ON)
option(SI_WITH_KERNEL "Build kernel driver" OFF)

# 최소 요구사항
cmake_minimum_required(VERSION 3.30.0)

# 프로젝트 설정
project(SystemInformer
    VERSION 3.0.0
    LANGUAGES C CXX
)

# 타겟 아키텍처
set(CMAKE_SYSTEM_PROCESSOR "x64" CACHE STRING "Target architecture")
```

### 4.4 WDK (Windows Driver Kit)

**버전**: Windows 11 WDK (10.0.22621)
**용도**: 커널 드라이버 빌드

#### 드라이버 빌드 설정

```xml
<!-- KSystemInformer.vcxproj -->
<PropertyGroup>
  <ConfigurationType>Driver</ConfigurationType>
  <DriverType>WDM</DriverType>
  <TargetVersion>Windows10</TargetVersion>
</PropertyGroup>
```

---

## 5. 써드파티 라이브러리

### 5.1 라이브러리 개요

```
tools/thirdparty/
├── detours/          # Microsoft Detours (함수 후킹)
├── jsonc/            # JSON-C (JSON 파싱)
├── maxminddb/        # MaxMind GeoIP 데이터베이스
├── md5/              # MD5 해싱
├── miniz/            # MinIZ (ZIP 압축)
├── mxml/             # Mini-XML (XML 파싱)
├── pcre/             # PCRE (정규 표현식)
├── sha/              # SHA-1 해싱
├── sha256/           # SHA-256 해싱
├── ssdeep/           # ssdeep (퍼지 해싱)
├── tlsh/             # TLSH (유사도 해싱)
├── xxhash/           # xxHash (고속 해싱)
├── zydis/            # Zydis (x86/x64 디스어셈블러)
└── winsdk/           # Windows SDK 래퍼
```

### 5.2 JSON-C

**용도**: JSON 파싱 및 생성
**사용 위치**: `phlib/json.c`

```c
// JSON 파싱 예제
json_object *root = json_tokener_parse(jsonString);
json_object *value;
if (json_object_object_get_ex(root, "key", &value)) {
    const char *str = json_object_get_string(value);
}
json_object_put(root);
```

### 5.3 PCRE (Perl Compatible Regular Expressions)

**용도**: 정규 표현식 검색
**사용 위치**: `phlib/regex.c`

```c
// 정규식 컴파일
pcre2_code *regex = pcre2_compile(
    pattern, PCRE2_ZERO_TERMINATED,
    0, &errorcode, &erroroffset, NULL
);

// 매칭 수행
pcre2_match_data *match_data = pcre2_match_data_create_from_pattern(regex, NULL);
int rc = pcre2_match(regex, subject, length, 0, 0, match_data, NULL);
```

### 5.4 Zydis

**용도**: x86/x64 명령어 디스어셈블
**사용 위치**: 디버거 기능

```c
// 디스어셈블 예제
ZydisDecoder decoder;
ZydisDecoderInit(&decoder, ZYDIS_MACHINE_MODE_LONG_64, ZYDIS_STACK_WIDTH_64);

ZydisDecodedInstruction instruction;
ZydisDecodedOperand operands[ZYDIS_MAX_OPERAND_COUNT];

if (ZYAN_SUCCESS(ZydisDecoderDecodeFull(
    &decoder, data, length,
    &instruction, operands))) {
    // 명령어 분석
}
```

### 5.5 Microsoft Detours

**용도**: 함수 후킹
**사용 위치**: `SystemInformer/delayhook.c`

```c
// 함수 후킹 예제
DetourTransactionBegin();
DetourUpdateThread(GetCurrentThread());
DetourAttach(&(PVOID&)TrueFunction, HookedFunction);
DetourTransactionCommit();
```

### 5.6 MaxMindDB

**용도**: GeoIP 위치 조회
**사용 위치**: `plugins/NetworkTools/`

```c
// GeoIP 조회
MMDB_lookup_result_s result = MMDB_lookup_string(&mmdb, ip_address, &gai_error, &mmdb_error);
if (result.found_entry) {
    MMDB_entry_data_s entry_data;
    MMDB_get_value(&result.entry, &entry_data, "country", "names", "en", NULL);
}
```

### 5.7 MinIZ

**용도**: ZIP 압축/해제
**사용 위치**: 업데이트 기능

```c
// ZIP 해제
mz_zip_archive zip;
mz_zip_reader_init_mem(&zip, data, size, 0);
mz_zip_reader_extract_to_file(&zip, index, dest_path, 0);
mz_zip_reader_end(&zip);
```

### 5.8 xxHash

**용도**: 고속 비암호화 해싱
**사용 위치**: 캐시 및 비교

```c
// 해시 계산
XXH64_hash_t hash = XXH64(data, length, seed);
```

### 5.9 ssdeep / TLSH

**용도**: 퍼지 해싱 (유사도 분석)
**사용 위치**: 악성코드 분석

```c
// ssdeep 해시
char hash[FUZZY_MAX_RESULT];
fuzzy_hash_buf(data, length, hash);

// TLSH 해시
Tlsh tlsh;
tlsh.update(data, length);
tlsh.final();
const char *hash = tlsh.getHash();
```

---

## 6. 개발 도구

### 6.1 디버깅 도구

| 도구 | 용도 |
|------|------|
| Visual Studio Debugger | 사용자 모드 디버깅 |
| WinDbg | 커널 모드 디버깅 |
| x64dbg | 리버스 엔지니어링 |
| Process Monitor | 시스템 활동 모니터링 |

### 6.2 정적 분석 도구

| 도구 | 용도 |
|------|------|
| Visual Studio Code Analysis | 정적 코드 분석 |
| PVS-Studio | 고급 정적 분석 |
| Cppcheck | C/C++ 정적 분석 |

### 6.3 빌드 도구

| 도구 | 용도 |
|------|------|
| CustomBuildTool | 커스텀 빌드 작업 |
| CustomSignTool | 코드 서명 |
| GenerateZw | Zw 함수 생성 |

---

## 7. 아키텍처 지원

### 7.1 지원 아키텍처

| 아키텍처 | 지원 | 비고 |
|----------|------|------|
| x86 (32-bit) | O | Windows 10+ |
| x64 (64-bit) | O | 주 대상, Windows 10+ |
| ARM64 | O | Windows 10+ |

### 7.2 아키텍처별 빌드 설정

```xml
<!-- Directory.Build.props -->
<PropertyGroup>
  <Platforms>Win32;x64;ARM64</Platforms>
</PropertyGroup>

<PropertyGroup Condition="'$(Platform)'=='Win32'">
  <PlatformToolset>v143</PlatformToolset>
</PropertyGroup>

<PropertyGroup Condition="'$(Platform)'=='x64'">
  <PlatformToolset>v143</PlatformToolset>
</PropertyGroup>

<PropertyGroup Condition="'$(Platform)'=='ARM64'">
  <PlatformToolset>v143</PlatformToolset>
</PropertyGroup>
```

---

## 8. 보안 기술

### 8.1 코드 서명

**요구사항**: EV 코드 서명 인증서 (드라이버)

```
인증서 체인:
└── Root CA
    └── Intermediate CA
        └── EV Code Signing Certificate
            └── 드라이버 서명
```

### 8.2 보안 개발 주기 (SDL)

```xml
<!-- Common.User.props -->
<PropertyGroup>
  <SDLCheck>true</SDLCheck>
  <TreatWarningAsError>true</TreatWarningAsError>
  <WarningLevel>Level3</WarningLevel>
</PropertyGroup>
```

### 8.3 보안 기능

| 기능 | 설명 |
|------|------|
| ASLR | 주소 공간 무작위화 |
| DEP | 데이터 실행 방지 |
| CFG | 컨트롤 플로우 가드 |
| SEHOP | SEH 덮어쓰기 방지 |
| GS | 스택 버퍼 오버런 탐지 |

---

## 9. 버전 호환성

### 9.1 Windows 버전 지원

| Windows 버전 | 빌드 | 지원 수준 |
|--------------|------|-----------|
| Windows 10 1507 | 10240 | 완전 |
| Windows 10 1903 | 18362 | 완전 |
| Windows 10 21H2 | 19044 | 완전 |
| Windows 11 21H2 | 22000 | 완전 |
| Windows 11 22H2 | 22621 | 완전 |
| Windows 11 23H2 | 22631 | 완전 |

> **참고**: Windows 10 이상이 공식 지원 요구 사항입니다. phnt 헤더에는 이전 Windows 버전의 정의가 포함되어 있지만, System Informer 자체는 Windows 10+에서만 지원됩니다.

### 9.2 동적 데이터 시스템

**파일**: `kphlib/kphdyn.xml`

```xml
<!-- Windows 버전별 오프셋 정의 -->
<Version BuildNumber="22621" Revision="1">
  <Offsets>
    <EPROCESS>
      <UniqueProcessId>0x440</UniqueProcessId>
      <ActiveProcessLinks>0x448</ActiveProcessLinks>
      <Token>0x4b8</Token>
      <ImageFileName>0x5a8</ImageFileName>
    </EPROCESS>
    <!-- 기타 구조체 오프셋 -->
  </Offsets>
</Version>
```

---

## 10. 기술스택 요약 표

| 카테고리 | 기술 | 버전/상세 |
|----------|------|-----------|
| **언어** | C | C11/C17 |
| | C++ | C++17/C++20 |
| | PowerShell | 5.1+ |
| **빌드** | Visual Studio | 2022 (v17.x) |
| | MSBuild | 17.x |
| | CMake | 3.30.0+ |
| | WDK | 10.0.22621 |
| **Windows API** | Win32 | Windows 10+ |
| | Native NT API | 비공개 API |
| | WDM | 커널 드라이버 |
| | ETW | 이벤트 추적 |
| | WMI | 시스템 관리 |
| | COM/DirectX | GPU 정보 |
| **라이브러리** | JSON-C | JSON 처리 |
| | PCRE | 정규식 |
| | Zydis | 디스어셈블러 |
| | Detours | 함수 후킹 |
| | MaxMindDB | GeoIP |
| | MinIZ | ZIP 압축 |
| | xxHash | 고속 해싱 |
| | ssdeep/TLSH | 퍼지 해싱 |
| **아키텍처** | x86 | 32-bit |
| | x64 | 64-bit (주) |
| | ARM64 | Windows 10+ |
