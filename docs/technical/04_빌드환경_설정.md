# System Informer 빌드환경 설정 가이드

## 문서 정보
- **프로젝트명**: System Informer
- **문서 버전**: 1.0
- **작성일**: 2026-01-25

---

## 1. 빌드환경 개요

### 1.1 빌드 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────────┐
│                       빌드 환경 구성                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    개발 환경 (필수)                           │   │
│  │  Visual Studio 2022 │ Windows 10/11 SDK │ Git               │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    드라이버 빌드 (선택)                       │   │
│  │  Windows Driver Kit (WDK) │ EV 코드 서명 인증서              │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    대안 빌드 시스템                           │   │
│  │          CMake (3.30.0+) │ Ninja                             │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 지원 빌드 구성

| 구성 | Platform | Configuration | 대상 |
|------|----------|---------------|------|
| Debug x86 | Win32 | Debug | 32비트 디버그 |
| Debug x64 | x64 | Debug | 64비트 디버그 |
| Debug ARM64 | ARM64 | Debug | ARM64 디버그 |
| Release x86 | Win32 | Release | 32비트 릴리스 |
| Release x64 | x64 | Release | 64비트 릴리스 |
| Release ARM64 | ARM64 | Release | ARM64 릴리스 |

---

## 2. 사전 요구사항

### 2.1 운영체제

- Windows 10 버전 1909 이상
- Windows 11 (권장)

### 2.2 Visual Studio 2022 설치

#### 필수 워크로드

```
설치해야 할 워크로드:

☑ C++를 사용한 데스크톱 개발
  ├── MSVC v143 - VS 2022 C++ x64/x86 빌드 도구
  ├── MSVC v143 - VS 2022 C++ ARM64 빌드 도구
  ├── Windows 10 SDK (10.0.22621.0)
  ├── C++ ATL for v143 빌드 도구 (x86 및 x64)
  ├── C++ ATL for v143 빌드 도구 (ARM64)
  └── C++ MFC for v143 빌드 도구 (x86 및 x64)
```

#### Visual Studio Installer 명령줄 설치

```powershell
# Visual Studio 2022 Community Edition 설치
winget install Microsoft.VisualStudio.2022.Community --silent --override "--add Microsoft.VisualStudio.Workload.NativeDesktop --add Microsoft.VisualStudio.Component.VC.Tools.x86.x64 --add Microsoft.VisualStudio.Component.VC.Tools.ARM64 --add Microsoft.VisualStudio.Component.Windows10SDK.22621 --add Microsoft.VisualStudio.Component.VC.ATL --add Microsoft.VisualStudio.Component.VC.ATL.ARM64 --add Microsoft.VisualStudio.Component.VC.ATLMFC"
```

### 2.3 Windows SDK

**버전**: 10.0.22621.0 이상

```powershell
# Windows SDK 설치 확인
Get-ItemProperty "HKLM:\SOFTWARE\WOW6432Node\Microsoft\Microsoft SDKs\Windows\v10.0" -Name ProductVersion
```

### 2.4 Git

```powershell
# Git 설치
winget install Git.Git

# 설치 확인
git --version
```

### 2.5 Windows Driver Kit (드라이버 빌드 시)

```powershell
# WDK 다운로드 및 설치
# https://docs.microsoft.com/en-us/windows-hardware/drivers/download-the-wdk

# 또는 winget 사용
winget install Microsoft.WindowsDriverKit
```

---

## 3. 소스 코드 준비

### 3.1 저장소 클론

```bash
# HTTPS 사용
git clone https://github.com/winsiderss/si.git systeminformer

# SSH 사용
git clone git@github.com:winsiderss/si.git systeminformer

# 디렉토리 이동
cd systeminformer
```

### 3.2 서브모듈 초기화

```bash
# 서브모듈 초기화 및 업데이트
git submodule update --init --recursive
```

### 3.3 디렉토리 구조 확인

```
systeminformer/
├── SystemInformer.sln         # 메인 솔루션
├── KSystemInformer.sln        # 드라이버 솔루션
├── Plugins.sln                # 플러그인 솔루션
├── CMakeLists.txt             # CMake 설정
├── build/                     # 빌드 스크립트
│   ├── build_init.cmd
│   ├── build_debug.cmd
│   ├── build_release.cmd
│   └── ...
├── SystemInformer/            # 메인 애플리케이션
├── phlib/                     # 핵심 라이브러리
├── phnt/                      # NT 헤더
├── kphlib/                    # KPH 라이브러리
├── KSystemInformer/           # 커널 드라이버
├── plugins/                   # 플러그인
└── tools/                     # 빌드 도구
```

---

## 4. Visual Studio 빌드

### 4.1 솔루션 열기

```
1. Visual Studio 2022 실행
2. 파일 → 열기 → 프로젝트/솔루션
3. SystemInformer.sln 선택
```

### 4.2 빌드 구성 선택

```
솔루션 구성: Release 또는 Debug
솔루션 플랫폼: x64 (권장) 또는 Win32, ARM64
```

### 4.3 빌드 실행

```
방법 1: 메뉴
빌드 → 솔루션 빌드 (Ctrl+Shift+B)

방법 2: 배치 빌드
빌드 → 솔루션 일괄 빌드
└── 원하는 구성 선택 후 빌드
```

### 4.4 빌드 출력 경로

```
빌드 출력 디렉토리:

bin/
├── Debug32/                   # 32비트 디버그
│   ├── SystemInformer.exe
│   ├── phlib.dll
│   └── plugins/
├── Debug64/                   # 64비트 디버그
│   ├── SystemInformer.exe
│   ├── phlib.dll
│   └── plugins/
├── Release32/                 # 32비트 릴리스
│   └── ...
├── Release64/                 # 64비트 릴리스
│   └── ...
└── ARM64/                     # ARM64
    └── ...
```

---

## 5. 명령줄 빌드

### 5.1 MSBuild 사용

#### Developer Command Prompt 열기

```
시작 메뉴 → Visual Studio 2022 → Developer Command Prompt for VS 2022
```

#### 기본 빌드

```cmd
:: 64비트 릴리스 빌드
msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=x64

:: 32비트 디버그 빌드
msbuild SystemInformer.sln /p:Configuration=Debug /p:Platform=Win32

:: ARM64 릴리스 빌드
msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=ARM64
```

#### 고급 옵션

```cmd
:: 병렬 빌드 (CPU 코어 수만큼)
msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=x64 /m

:: 상세 로깅
msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=x64 /v:detailed

:: 클린 후 빌드
msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=x64 /t:Clean,Build

:: 특정 프로젝트만 빌드
msbuild SystemInformer/SystemInformer.vcxproj /p:Configuration=Release /p:Platform=x64
```

### 5.2 빌드 스크립트 사용

#### 디버그 빌드

```cmd
:: build 디렉토리로 이동
cd build

:: 디버그 빌드 실행
build_debug.cmd
```

#### 릴리스 빌드

```cmd
cd build

:: 릴리스 빌드 실행
build_release.cmd
```

#### 전체 빌드 과정

```cmd
cd build

:: 1. 초기화
build_init.cmd

:: 2. 써드파티 라이브러리 빌드
build_thirdparty.cmd

:: 3. 메인 빌드
build_release.cmd

:: 4. 플러그인 빌드
msbuild ../Plugins.sln /p:Configuration=Release /p:Platform=x64
```

---

## 6. CMake 빌드

### 6.1 CMake 설치

```powershell
# winget 사용
winget install Kitware.CMake

# 버전 확인 (3.30.0 이상 필요)
cmake --version
```

### 6.2 Ninja 설치 (선택)

```powershell
winget install Ninja-build.Ninja
```

### 6.3 CMake 구성

```bash
# 빌드 디렉토리 생성
mkdir cmake-build && cd cmake-build

# Visual Studio 생성기 사용
cmake .. -G "Visual Studio 17 2022" -A x64

# Ninja 생성기 사용 (빠른 빌드)
cmake .. -G Ninja -DCMAKE_BUILD_TYPE=Release
```

### 6.4 CMake 빌드 옵션

```bash
# 옵션 설명
cmake .. -G Ninja \
    -DCMAKE_BUILD_TYPE=Release \      # 빌드 타입 (Debug/Release)
    -DSI_WITH_CORE=ON \               # 코어 컴포넌트 빌드
    -DSI_WITH_PLUGINS=ON \            # 플러그인 빌드
    -DSI_WITH_KERNEL=OFF              # 커널 드라이버 빌드 (기본 OFF)
```

### 6.5 CMake 빌드 실행

```bash
# 빌드 실행
cmake --build . --config Release

# 병렬 빌드
cmake --build . --config Release --parallel

# 특정 타겟만 빌드
cmake --build . --config Release --target SystemInformer
```

---

## 7. 커널 드라이버 빌드

### 7.1 사전 요구사항

```
필수 요소:
☑ Windows Driver Kit (WDK) 10.0.22621 이상
☑ Visual Studio 2022 WDK 확장
☑ 테스트 서명 모드 활성화 (개발 시)
☑ EV 코드 서명 인증서 (릴리스 배포 시)
```

### 7.2 WDK 설치 확인

```powershell
# WDK 설치 확인
Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows Kits\Installed Roots" -Name KitsRoot10
```

### 7.3 드라이버 솔루션 빌드

```cmd
:: Visual Studio에서
1. KSystemInformer.sln 열기
2. 구성: Release, 플랫폼: x64 선택
3. 솔루션 빌드

:: 명령줄에서
msbuild KSystemInformer.sln /p:Configuration=Release /p:Platform=x64
```

### 7.4 테스트 서명 모드 활성화

```cmd
:: 관리자 권한 명령 프롬프트에서

:: 테스트 서명 모드 활성화
bcdedit /set testsigning on

:: 재부팅 필요
shutdown /r /t 0
```

### 7.5 드라이버 서명 (개발용)

```cmd
:: 테스트 인증서 생성
makecert -r -pe -ss PrivateCertStore -n "CN=SystemInformer Test" SystemInformer.cer

:: 드라이버 서명
signtool sign /s PrivateCertStore /n "SystemInformer Test" /t http://timestamp.digicert.com KSystemInformer.sys
```

### 7.6 프로덕션 서명 (EV 인증서)

```cmd
:: EV 코드 서명 인증서로 서명
signtool sign /fd SHA256 /tr http://timestamp.digicert.com /td SHA256 /sha1 <인증서_지문> KSystemInformer.sys

:: WHQL 서명 (Microsoft 제출 후)
```

---

## 8. 플러그인 빌드

### 8.1 플러그인 솔루션 빌드

```cmd
:: Visual Studio에서
1. Plugins.sln 열기
2. 구성 선택 후 빌드

:: 명령줄에서
msbuild Plugins.sln /p:Configuration=Release /p:Platform=x64
```

### 8.2 개별 플러그인 빌드

```cmd
:: 특정 플러그인만 빌드
msbuild plugins/ExtendedTools/ExtendedTools.vcxproj /p:Configuration=Release /p:Platform=x64
```

### 8.3 플러그인 출력 위치

```
bin/Release64/plugins/
├── DotNetTools.dll
├── ExtendedTools.dll
├── HardwareDevices.dll
├── NetworkTools.dll
├── ExtendedServices.dll
├── ExtendedNotifications.dll
├── ToolStatus.dll
├── OnlineChecks.dll
├── Updater.dll
├── UserNotes.dll
└── WindowExplorer.dll
```

---

## 9. 빌드 구성 파일

### 9.1 Directory.Build.props

**위치**: 프로젝트 루트

```xml
<?xml version="1.0" encoding="utf-8"?>
<Project>
  <PropertyGroup>
    <!-- 기본 출력 디렉토리 -->
    <OutDir>$(SolutionDir)bin\$(Configuration)$(Platform)\</OutDir>
    <IntDir>$(SolutionDir)obj\$(Configuration)$(Platform)\$(ProjectName)\</IntDir>

    <!-- Windows SDK 버전 -->
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>

    <!-- 플랫폼 툴셋 -->
    <PlatformToolset>v143</PlatformToolset>
  </PropertyGroup>
</Project>
```

### 9.2 Common.User.props

**위치**: `build/Common.User.props`

```xml
<?xml version="1.0" encoding="utf-8"?>
<Project>
  <PropertyGroup>
    <!-- 컴파일러 설정 -->
    <TreatWarningAsError>true</TreatWarningAsError>
    <WarningLevel>Level3</WarningLevel>
    <SDLCheck>true</SDLCheck>
    <MultiProcessorCompilation>true</MultiProcessorCompilation>
    <LanguageStandard>stdcplatest</LanguageStandard>
    <ConformanceMode>true</ConformanceMode>
  </PropertyGroup>

  <PropertyGroup>
    <!-- 링커 설정 -->
    <LinkTimeCodeGeneration>UseLinkTimeCodeGeneration</LinkTimeCodeGeneration>
    <EnableCOMDATFolding>true</EnableCOMDATFolding>
    <OptimizeReferences>true</OptimizeReferences>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)'=='Debug'">
    <Optimization>Disabled</Optimization>
    <RuntimeLibrary>MultiThreadedDebugDLL</RuntimeLibrary>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)'=='Release'">
    <Optimization>MaxSpeed</Optimization>
    <RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>
    <FunctionLevelLinking>true</FunctionLevelLinking>
    <IntrinsicFunctions>true</IntrinsicFunctions>
  </PropertyGroup>
</Project>
```

### 9.3 Common.Kernel.props

**위치**: `build/Common.Kernel.props`

```xml
<?xml version="1.0" encoding="utf-8"?>
<Project>
  <PropertyGroup>
    <ConfigurationType>Driver</ConfigurationType>
    <DriverType>WDM</DriverType>
    <TargetVersion>Windows10</TargetVersion>
    <_NT_TARGET_VERSION>0x0A00</_NT_TARGET_VERSION>
  </PropertyGroup>

  <PropertyGroup>
    <SpectreMitigation>Spectre</SpectreMitigation>
    <EnableASAN>false</EnableASAN>
  </PropertyGroup>
</Project>
```

---

## 10. 디버깅 설정

### 10.1 Visual Studio 디버깅

#### 사용자 모드 디버깅

```
프로젝트 속성 → 디버깅
├── 명령: $(OutDir)SystemInformer.exe
├── 작업 디렉토리: $(OutDir)
└── 디버거 유형: 자동
```

#### 기호 서버 설정

```
도구 → 옵션 → 디버깅 → 기호
├── Microsoft 기호 서버 활성화
└── 캐시 위치: C:\Symbols
```

### 10.2 커널 모드 디버깅

#### WinDbg 설정

```cmd
:: 대상 컴퓨터에서 디버그 모드 활성화
bcdedit /debug on
bcdedit /dbgsettings net hostip:192.168.1.100 port:50000

:: 재부팅
shutdown /r /t 0
```

#### WinDbg 연결

```
File → Kernel Debug → Net
├── Port Number: 50000
├── Key: <자동 생성된 키>
└── Target: <대상 IP>
```

### 10.3 디버그 출력

#### 코드에서 디버그 출력

```c
// phlib 디버그 매크로
dprintf("Debug message: %d\n", value);

// 커널 모드
KdPrint(("Kernel debug: %d\n", value));
DbgPrintEx(DPFLTR_DEFAULT_ID, DPFLTR_INFO_LEVEL, "Info: %d\n", value);
```

#### DebugView로 출력 확인

```
1. Sysinternals DebugView 실행
2. Capture → Capture Global Win32 활성화
3. 애플리케이션 실행
```

---

## 11. CI/CD 설정

### 11.1 GitHub Actions

**파일 위치**: `.github/workflows/`

```yaml
# .github/workflows/build.yml
name: Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1.1

    - name: Build x64 Release
      run: msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=x64 /m

    - name: Build x86 Release
      run: msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=Win32 /m

    - name: Build Plugins
      run: msbuild Plugins.sln /p:Configuration=Release /p:Platform=x64 /m

    - name: Upload Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: SystemInformer-x64
        path: bin/Release64/
```

### 11.2 로컬 자동 빌드 스크립트

**파일**: `build/build_all.cmd`

```cmd
@echo off
setlocal enabledelayedexpansion

echo ========================================
echo System Informer Full Build Script
echo ========================================

:: Visual Studio 경로 찾기
set VSWHERE="%ProgramFiles(x86)%\Microsoft Visual Studio\Installer\vswhere.exe"
for /f "usebackq tokens=*" %%i in (`%VSWHERE% -latest -property installationPath`) do set VSINSTALL=%%i

:: Developer Command Prompt 환경 설정
call "%VSINSTALL%\Common7\Tools\VsDevCmd.bat" -arch=amd64

:: 빌드 시작
echo.
echo [1/4] Building x64 Release...
msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=x64 /m /v:minimal
if errorlevel 1 goto :error

echo.
echo [2/4] Building x86 Release...
msbuild SystemInformer.sln /p:Configuration=Release /p:Platform=Win32 /m /v:minimal
if errorlevel 1 goto :error

echo.
echo [3/4] Building Plugins...
msbuild Plugins.sln /p:Configuration=Release /p:Platform=x64 /m /v:minimal
if errorlevel 1 goto :error

echo.
echo [4/4] Build completed successfully!
goto :end

:error
echo.
echo Build failed with error code %errorlevel%
exit /b %errorlevel%

:end
endlocal
```

---

## 12. 문제 해결

### 12.1 일반적인 빌드 오류

#### 오류: SDK를 찾을 수 없음

```
해결 방법:
1. Visual Studio Installer 실행
2. 수정 → 개별 구성 요소
3. Windows 10 SDK (10.0.22621.0) 선택 후 설치
```

#### 오류: ATL/MFC 헤더를 찾을 수 없음

```
해결 방법:
1. Visual Studio Installer 실행
2. C++ ATL for v143 build tools 설치
3. C++ MFC for v143 build tools 설치
```

#### 오류: ARM64 빌드 실패

```
해결 방법:
1. Visual Studio Installer 실행
2. MSVC v143 - VS 2022 C++ ARM64 build tools 설치
3. Windows SDK ARM64 구성 요소 설치
```

### 12.2 드라이버 빌드 오류

#### 오류: WDK를 찾을 수 없음

```
해결 방법:
1. WDK 설치 확인
2. Visual Studio WDK 확장 설치
3. Visual Studio 재시작
```

#### 오류: 서명 실패

```
해결 방법:
1. 테스트 서명 모드 활성화: bcdedit /set testsigning on
2. 재부팅
3. 또는 프로덕션용 EV 인증서 사용
```

### 12.3 링크 오류

#### 오류: 해결되지 않은 외부 기호

```
확인 사항:
1. 모든 의존 프로젝트가 빌드되었는지 확인
2. 라이브러리 경로 확인
3. 플랫폼/구성 일치 확인
```

---

## 13. 빌드 최적화

### 13.1 빌드 시간 단축

```xml
<!-- Directory.Build.props에 추가 -->
<PropertyGroup>
  <!-- 병렬 컴파일 -->
  <MultiProcessorCompilation>true</MultiProcessorCompilation>

  <!-- 증분 링크 (Debug) -->
  <LinkIncremental Condition="'$(Configuration)'=='Debug'">true</LinkIncremental>

  <!-- 미리 컴파일된 헤더 사용 -->
  <PrecompiledHeader>Use</PrecompiledHeader>
</PropertyGroup>
```

### 13.2 출력 크기 최적화

```xml
<!-- Release 구성에서 -->
<PropertyGroup Condition="'$(Configuration)'=='Release'">
  <!-- 함수 수준 링킹 -->
  <FunctionLevelLinking>true</FunctionLevelLinking>

  <!-- 사용하지 않는 참조 제거 -->
  <OptimizeReferences>true</OptimizeReferences>

  <!-- COMDAT 폴딩 -->
  <EnableCOMDATFolding>true</EnableCOMDATFolding>

  <!-- 링크 타임 코드 생성 -->
  <LinkTimeCodeGeneration>UseLinkTimeCodeGeneration</LinkTimeCodeGeneration>
</PropertyGroup>
```

---

## 14. 빌드 출력물

### 14.1 릴리스 빌드 출력

```
bin/Release64/
├── SystemInformer.exe         # 메인 실행 파일
├── phlib.dll                  # 핵심 라이브러리
├── peview.exe                 # PE 뷰어
├── kphlib.dll                 # KPH 라이브러리
├── plugins/                   # 플러그인 폴더
│   ├── DotNetTools.dll
│   ├── ExtendedTools.dll
│   ├── HardwareDevices.dll
│   ├── NetworkTools.dll
│   ├── ExtendedServices.dll
│   ├── ExtendedNotifications.dll
│   ├── ToolStatus.dll
│   ├── OnlineChecks.dll
│   ├── Updater.dll
│   ├── UserNotes.dll
│   └── WindowExplorer.dll
├── SystemInformer.pdb         # 디버그 심볼
└── phlib.pdb
```

### 14.2 드라이버 빌드 출력

```
bin/Release64/
├── KSystemInformer.sys        # 커널 드라이버
├── KSystemInformer.pdb        # 드라이버 심볼
├── KSystemInformer.inf        # 드라이버 설치 파일
└── ksidll.dll                 # 드라이버 DLL
```

### 14.3 배포 패키지 생성

```cmd
:: MSIX 패키지 빌드
cd build
build_msix.cmd

:: 출력
setup/SystemInformer-x64.msix
```

---

## 15. 빌드 환경 체크리스트

```
빌드 전 확인 사항:

□ Visual Studio 2022 설치됨
□ Windows 10 SDK (10.0.22621.0) 설치됨
□ C++ ATL/MFC 구성 요소 설치됨
□ Git 설치됨
□ 소스 코드 클론됨
□ 서브모듈 초기화됨

드라이버 빌드 시 추가 확인:
□ WDK 설치됨
□ 테스트 서명 모드 활성화됨 (개발용)
□ EV 코드 서명 인증서 준비됨 (배포용)

선택적 확인 사항:
□ CMake 3.30.0+ 설치됨
□ Ninja 설치됨
□ WinDbg 설치됨 (디버깅용)
```
